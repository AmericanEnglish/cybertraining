Team 1 Project of the CyberTraining program at UMBC in 2019 (http://cybertraining.umbc.edu/)

**Title**: Assessing Water Budget Sensitivity to Precipitation Forcing Errors in Potomac River Basin Using VIC Model

**Team members**: Reetam Majumder, Jianyu Zheng, Redwan Walid
**Clients**: Kel Markert, Amita Mehta, Nagaraj K. Neerchal
**Mentors**: Aryya Gangopadhyay, Matthias K. Gobbert,Jianwu Wang, Zhibo Zhang
**RAs**: Carlos Barajas, Pei Guo, Chamara Rajapakshe

**Abstract**: Variable Infiltration Capacity (VIC) is an open source hydrologic model that can simulate land surface-atmosphere fluxes of moisture and energy. We used it to test the effect of precipitation uncertainties on water budget components for the Potomac river basin from April to September 2017. We deployed VIC on taki and streamlined the process of data acquisition, model estimation and inference.  Alongside estimating the water balance components for the basin, we analyzed the sensitivity of the monthly water balance components by increasing variability in input precipitation using parametric resampling methods. We were able to determine which months and which sub-basins within the Potomac were most sensitive to precipitation forcings, and propose approaches to model the precipitation data spatio-temporally.

**Structures of implementation**:

Step 1: Pre-processcing of VIC input data

Step 2: VIC simulated water balance Analysis 

Step 3: Sensitivities analysis based on the perturbation of precipitation

**Instructions on how to run the code**

-------------------------01 MODIS Reprojection Bash Scripts----------------------

The bash scripts for converting HDF files of MODIS level-2 products to GeoTIFF files with WGS-84 projection by HEG.
Products include Land Cover (MCD12Q1-Yearly), Leaf Area Index (MCD15A2-8 days) and shortwave Albedo (MCD43A3-Daily)

LAI-merge_hdf_tiff.bash:
Since LAI cannot be convert correctly from HEG because the file name is not match with the setups of HEG, it will generate some stripe errors which is no way to be code-based fixed. Then we directly use the stitch function of HEG to merge hdf files in different regions (will introduce them indetails in 02) to avoid the individually GeoTIFF converting. This bash script is for stitch merging and convertion directly from 4 regions to be one map projection as GeoTIFF file.

Albedo_convert_tiff:
Directly convert HDF files to GeoTIFF files individually for 4 regions which contain Potomac Basin partly (h11v04,h11v05,h12v04,h12v05).

-------------------------02 GeoTiff Average-------------------------

The Python3 scripts for averaging LAI from 8-days to monthly and SW-Albedo from daily to monthly. Noted that Land Cover product will remain yearly becasue it's the stable variable.

Codes:
tiff_average_12Q1.py:
Rewrite Land Cover Product with the same data except taking 255 non-valid data off.

tiff-average-15A2_stiched.py:
Average merged GeoTIFF 8-days LAI data monthly by using weight average method.

tiff_average_43A3.py:
Average GeoTIFF daily SW-Albedo data monthly by using weight average method.

-------------------------03 Output Analysis-------------------------

The Python3 and R scripts for analyzing and plotting output results from VIC, which are monthly precipitation, monthly water balance and water balance sensiticity of the preturbation of precipitaion with factors of Coefficient Variance (CV) and IQR.

Codes:

output.R
Generates CSV files required to create heatmaps for precipitation and water balance. Also prints bar chart for the monthly water budget components.

precip_plot.py:
plotting monthly precipitation generated from VIC outputs.

balance_plot.py:
plotting monthly water balance generated from VIC outputs.

-------------------------04 Sensitivity Analysis-------------------------

01 precip.R
Basic spatio-temporal analysis of the precipitation data from the meteo_forcing files generated by VIC preprocessing

02 bootstrap_final.R
Creates simulation ensembles using parametric resampling

03 bootstrap_output.R
Evaluates the mean and SE, IQR of the water balance spatially and temporally based on inflated variance. Also generates empirical 95% CI for the mean precipitation and prints a barchart for the mean estimated water balance (with CI) for each month.

perturb_plot.py:
plotting water balance sensiticity of the preturbation of precipitaion with factors of CV and IQR.
